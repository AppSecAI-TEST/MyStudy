周报 -- 2014-11-01
--- 
1. 工作
    1. 团购维护
    2. 团购缓存优化
    3. Hunter项目交接
    
2. 其他
    1. 关于团购缓存的方案，之前的想法是通过空间换时间，因为大部分调用是先获取IDs，然后通过IDs来获取团购数据。所以，我将商品按照IDs的顺序进行了缓存，这样就会带来一个排列的问题，就是有ID为1，2，3的商品，通过ID批量接口查询的时候，会调用\*\*\*\*\_{1,2,3}这个缓存，但是如果顺序变了，则会调用\*\*\*\*\_{2,1,3}，这样缓存的空间会暴涨。事实也是.
    2. 后来的改进就是将IDs进行排序，然后进行查找。但是，实际效果不好，命中率只有75左右，而且空间占用很大。
    3. 现在线上的方式，就是缓存单个商品，然后批量查找的方式。
    4. 本来想改进的方法，就是类似于内存管理的，最后使用优先的方式，每一次调用，就刷新一下这个缓存的时间，并且对于单个商品，他的修改和删除，我这边可控，也就是会去异步的删除过期的缓存。不过如果这样，理论上，缓存的命中率会95%以上，但是，因为每一次的get都会有set，所以QPS会*2.最后没有采用。
    5. 后来想想，其实这一步可以放到Redis中，只需要改动一点源码就可以了。不过，删除和更新的操作能否一定通知到，就是一个问题了。
    
3. 坑
    1. 晚上1点多，接樱木的电话，说团购接口有问题，后来查实，是因为我在接口中做了时间校验。按照正常途径，用户会先打开团购图墙，然后点击具体的商品。因为团购链接是新生成的，用户直接访问的概率为0.所以，我在点击团购图墙的时候会生成该页所有商品的缓存，之后的详情，会通过缓存进行获取，如果直接调用商品详情，且不为小仙小侠，我会进行时间校验。但是先图墙，然后进入详情，这是没问题的。樱木的调用问题就是，直接调用了商品详情，没有图墙操作，所以没有生成缓存，接口会进行时间校验，结果就是出现没有数据的情况。。。。这个没有考虑周全。
    