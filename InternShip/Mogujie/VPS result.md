VPS 算法结果
---

按照之前讨论的方式,使用20次最近检查情况作为VPS的判断依据,同时考虑了每日获取的VPS的分布情况,做了优化.

目前数据库中有312条VPS数据,检查一遍的时间为3分钟,休息5分钟之后重新检查.考虑到之前从2012年12月到现在,数据库中只有5000条数据(包含失效VPS),所以没有采用多线程的方式进行检查.

**对VPS可用的描述:2秒之内能依次访问百度,淘宝,美丽说.如果超时,也认为不可用**

首先,当爬取到的VPS可用时,则插入数据库,数据库默认数据为成功率100%,检查字段为'1'.

然后检查线程介入.每访问依次,依据检查情况对检查字段进行追加'1'或'0',如果超过20,则取最新的20次.具体例子如下:

'111'成功则为'1111'

'11111 11111 11111 11110'成功则为'11111 11111 11111 11101'

*空格为更好的区分.*

同时按照成功次数,计算成功率的公式为: rate = 字符中'1'的个数 / 字符长度

通过访问时间算出平均访问时间的公式为 perTakeTime = \(new Time + perTakeTime * times\) / \(times + 1\)

这样的好处为,如果有一次异常值,则可以很快的消除他的影响,同时,如果最近一次访问时间偏长,则也能很明显的反应.

###结果

目前,爬取的VPS为312个,其中,非全0数据为170个,其中25个成功率为100%,26个为95%,75以上的为99个.基本满足需求.同时对每个阶段的数据进行抽样测试,发现基本稳定.因为在检查的时候,要求比较
严,所以造成很多可用的VPS成功率偏低(原因为访问等待时间过长),所以,之前通过两个判断级别的方法可以简化为只看成功率.因为测试下来,基本都在500ms之内(超过500已经被判定失败).结合业务需求,
对于爬虫,每天提供20-25个VPS,剩下的VPS,85以上的还有近60个,可以满足其他业务需求.

判定为100的VPS,其效果优于购买的VPS,所以在VPS项目结束,将会重写爬虫的VPS管理类.




